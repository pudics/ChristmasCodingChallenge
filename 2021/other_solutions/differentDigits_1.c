#include "differentDigits.h"


/*
 * Lookup table for the individual digits in range [0..999], shall be placed to RAM (~3kb).
 * If this memory usage is too much the range can be changed to [0..99].
 * It is slower than the [0..999] range, but still faster than the "brute force" method (modulo and division by 10 in every loop).
 */
static uint8 index_table[1000][3] =
{
{0,0,0},{0,0,1},{0,0,2},{0,0,3},{0,0,4},{0,0,5},{0,0,6},{0,0,7},{0,0,8},{0,0,9},{0,1,0},{0,1,1},{0,1,2},{0,1,3},{0,1,4},
{0,1,5},{0,1,6},{0,1,7},{0,1,8},{0,1,9},{0,2,0},{0,2,1},{0,2,2},{0,2,3},{0,2,4},{0,2,5},{0,2,6},{0,2,7},{0,2,8},{0,2,9},
{0,3,0},{0,3,1},{0,3,2},{0,3,3},{0,3,4},{0,3,5},{0,3,6},{0,3,7},{0,3,8},{0,3,9},{0,4,0},{0,4,1},{0,4,2},{0,4,3},{0,4,4},
{0,4,5},{0,4,6},{0,4,7},{0,4,8},{0,4,9},{0,5,0},{0,5,1},{0,5,2},{0,5,3},{0,5,4},{0,5,5},{0,5,6},{0,5,7},{0,5,8},{0,5,9},
{0,6,0},{0,6,1},{0,6,2},{0,6,3},{0,6,4},{0,6,5},{0,6,6},{0,6,7},{0,6,8},{0,6,9},{0,7,0},{0,7,1},{0,7,2},{0,7,3},{0,7,4},
{0,7,5},{0,7,6},{0,7,7},{0,7,8},{0,7,9},{0,8,0},{0,8,1},{0,8,2},{0,8,3},{0,8,4},{0,8,5},{0,8,6},{0,8,7},{0,8,8},{0,8,9},
{0,9,0},{0,9,1},{0,9,2},{0,9,3},{0,9,4},{0,9,5},{0,9,6},{0,9,7},{0,9,8},{0,9,9},{1,0,0},{1,0,1},{1,0,2},{1,0,3},{1,0,4},
{1,0,5},{1,0,6},{1,0,7},{1,0,8},{1,0,9},{1,1,0},{1,1,1},{1,1,2},{1,1,3},{1,1,4},{1,1,5},{1,1,6},{1,1,7},{1,1,8},{1,1,9},
{1,2,0},{1,2,1},{1,2,2},{1,2,3},{1,2,4},{1,2,5},{1,2,6},{1,2,7},{1,2,8},{1,2,9},{1,3,0},{1,3,1},{1,3,2},{1,3,3},{1,3,4},
{1,3,5},{1,3,6},{1,3,7},{1,3,8},{1,3,9},{1,4,0},{1,4,1},{1,4,2},{1,4,3},{1,4,4},{1,4,5},{1,4,6},{1,4,7},{1,4,8},{1,4,9},
{1,5,0},{1,5,1},{1,5,2},{1,5,3},{1,5,4},{1,5,5},{1,5,6},{1,5,7},{1,5,8},{1,5,9},{1,6,0},{1,6,1},{1,6,2},{1,6,3},{1,6,4},
{1,6,5},{1,6,6},{1,6,7},{1,6,8},{1,6,9},{1,7,0},{1,7,1},{1,7,2},{1,7,3},{1,7,4},{1,7,5},{1,7,6},{1,7,7},{1,7,8},{1,7,9},
{1,8,0},{1,8,1},{1,8,2},{1,8,3},{1,8,4},{1,8,5},{1,8,6},{1,8,7},{1,8,8},{1,8,9},{1,9,0},{1,9,1},{1,9,2},{1,9,3},{1,9,4},
{1,9,5},{1,9,6},{1,9,7},{1,9,8},{1,9,9},{2,0,0},{2,0,1},{2,0,2},{2,0,3},{2,0,4},{2,0,5},{2,0,6},{2,0,7},{2,0,8},{2,0,9},
{2,1,0},{2,1,1},{2,1,2},{2,1,3},{2,1,4},{2,1,5},{2,1,6},{2,1,7},{2,1,8},{2,1,9},{2,2,0},{2,2,1},{2,2,2},{2,2,3},{2,2,4},
{2,2,5},{2,2,6},{2,2,7},{2,2,8},{2,2,9},{2,3,0},{2,3,1},{2,3,2},{2,3,3},{2,3,4},{2,3,5},{2,3,6},{2,3,7},{2,3,8},{2,3,9},
{2,4,0},{2,4,1},{2,4,2},{2,4,3},{2,4,4},{2,4,5},{2,4,6},{2,4,7},{2,4,8},{2,4,9},{2,5,0},{2,5,1},{2,5,2},{2,5,3},{2,5,4},
{2,5,5},{2,5,6},{2,5,7},{2,5,8},{2,5,9},{2,6,0},{2,6,1},{2,6,2},{2,6,3},{2,6,4},{2,6,5},{2,6,6},{2,6,7},{2,6,8},{2,6,9},
{2,7,0},{2,7,1},{2,7,2},{2,7,3},{2,7,4},{2,7,5},{2,7,6},{2,7,7},{2,7,8},{2,7,9},{2,8,0},{2,8,1},{2,8,2},{2,8,3},{2,8,4},
{2,8,5},{2,8,6},{2,8,7},{2,8,8},{2,8,9},{2,9,0},{2,9,1},{2,9,2},{2,9,3},{2,9,4},{2,9,5},{2,9,6},{2,9,7},{2,9,8},{2,9,9},
{3,0,0},{3,0,1},{3,0,2},{3,0,3},{3,0,4},{3,0,5},{3,0,6},{3,0,7},{3,0,8},{3,0,9},{3,1,0},{3,1,1},{3,1,2},{3,1,3},{3,1,4},
{3,1,5},{3,1,6},{3,1,7},{3,1,8},{3,1,9},{3,2,0},{3,2,1},{3,2,2},{3,2,3},{3,2,4},{3,2,5},{3,2,6},{3,2,7},{3,2,8},{3,2,9},
{3,3,0},{3,3,1},{3,3,2},{3,3,3},{3,3,4},{3,3,5},{3,3,6},{3,3,7},{3,3,8},{3,3,9},{3,4,0},{3,4,1},{3,4,2},{3,4,3},{3,4,4},
{3,4,5},{3,4,6},{3,4,7},{3,4,8},{3,4,9},{3,5,0},{3,5,1},{3,5,2},{3,5,3},{3,5,4},{3,5,5},{3,5,6},{3,5,7},{3,5,8},{3,5,9},
{3,6,0},{3,6,1},{3,6,2},{3,6,3},{3,6,4},{3,6,5},{3,6,6},{3,6,7},{3,6,8},{3,6,9},{3,7,0},{3,7,1},{3,7,2},{3,7,3},{3,7,4},
{3,7,5},{3,7,6},{3,7,7},{3,7,8},{3,7,9},{3,8,0},{3,8,1},{3,8,2},{3,8,3},{3,8,4},{3,8,5},{3,8,6},{3,8,7},{3,8,8},{3,8,9},
{3,9,0},{3,9,1},{3,9,2},{3,9,3},{3,9,4},{3,9,5},{3,9,6},{3,9,7},{3,9,8},{3,9,9},{4,0,0},{4,0,1},{4,0,2},{4,0,3},{4,0,4},
{4,0,5},{4,0,6},{4,0,7},{4,0,8},{4,0,9},{4,1,0},{4,1,1},{4,1,2},{4,1,3},{4,1,4},{4,1,5},{4,1,6},{4,1,7},{4,1,8},{4,1,9},
{4,2,0},{4,2,1},{4,2,2},{4,2,3},{4,2,4},{4,2,5},{4,2,6},{4,2,7},{4,2,8},{4,2,9},{4,3,0},{4,3,1},{4,3,2},{4,3,3},{4,3,4},
{4,3,5},{4,3,6},{4,3,7},{4,3,8},{4,3,9},{4,4,0},{4,4,1},{4,4,2},{4,4,3},{4,4,4},{4,4,5},{4,4,6},{4,4,7},{4,4,8},{4,4,9},
{4,5,0},{4,5,1},{4,5,2},{4,5,3},{4,5,4},{4,5,5},{4,5,6},{4,5,7},{4,5,8},{4,5,9},{4,6,0},{4,6,1},{4,6,2},{4,6,3},{4,6,4},
{4,6,5},{4,6,6},{4,6,7},{4,6,8},{4,6,9},{4,7,0},{4,7,1},{4,7,2},{4,7,3},{4,7,4},{4,7,5},{4,7,6},{4,7,7},{4,7,8},{4,7,9},
{4,8,0},{4,8,1},{4,8,2},{4,8,3},{4,8,4},{4,8,5},{4,8,6},{4,8,7},{4,8,8},{4,8,9},{4,9,0},{4,9,1},{4,9,2},{4,9,3},{4,9,4},
{4,9,5},{4,9,6},{4,9,7},{4,9,8},{4,9,9},{5,0,0},{5,0,1},{5,0,2},{5,0,3},{5,0,4},{5,0,5},{5,0,6},{5,0,7},{5,0,8},{5,0,9},
{5,1,0},{5,1,1},{5,1,2},{5,1,3},{5,1,4},{5,1,5},{5,1,6},{5,1,7},{5,1,8},{5,1,9},{5,2,0},{5,2,1},{5,2,2},{5,2,3},{5,2,4},
{5,2,5},{5,2,6},{5,2,7},{5,2,8},{5,2,9},{5,3,0},{5,3,1},{5,3,2},{5,3,3},{5,3,4},{5,3,5},{5,3,6},{5,3,7},{5,3,8},{5,3,9},
{5,4,0},{5,4,1},{5,4,2},{5,4,3},{5,4,4},{5,4,5},{5,4,6},{5,4,7},{5,4,8},{5,4,9},{5,5,0},{5,5,1},{5,5,2},{5,5,3},{5,5,4},
{5,5,5},{5,5,6},{5,5,7},{5,5,8},{5,5,9},{5,6,0},{5,6,1},{5,6,2},{5,6,3},{5,6,4},{5,6,5},{5,6,6},{5,6,7},{5,6,8},{5,6,9},
{5,7,0},{5,7,1},{5,7,2},{5,7,3},{5,7,4},{5,7,5},{5,7,6},{5,7,7},{5,7,8},{5,7,9},{5,8,0},{5,8,1},{5,8,2},{5,8,3},{5,8,4},
{5,8,5},{5,8,6},{5,8,7},{5,8,8},{5,8,9},{5,9,0},{5,9,1},{5,9,2},{5,9,3},{5,9,4},{5,9,5},{5,9,6},{5,9,7},{5,9,8},{5,9,9},
{6,0,0},{6,0,1},{6,0,2},{6,0,3},{6,0,4},{6,0,5},{6,0,6},{6,0,7},{6,0,8},{6,0,9},{6,1,0},{6,1,1},{6,1,2},{6,1,3},{6,1,4},
{6,1,5},{6,1,6},{6,1,7},{6,1,8},{6,1,9},{6,2,0},{6,2,1},{6,2,2},{6,2,3},{6,2,4},{6,2,5},{6,2,6},{6,2,7},{6,2,8},{6,2,9},
{6,3,0},{6,3,1},{6,3,2},{6,3,3},{6,3,4},{6,3,5},{6,3,6},{6,3,7},{6,3,8},{6,3,9},{6,4,0},{6,4,1},{6,4,2},{6,4,3},{6,4,4},
{6,4,5},{6,4,6},{6,4,7},{6,4,8},{6,4,9},{6,5,0},{6,5,1},{6,5,2},{6,5,3},{6,5,4},{6,5,5},{6,5,6},{6,5,7},{6,5,8},{6,5,9},
{6,6,0},{6,6,1},{6,6,2},{6,6,3},{6,6,4},{6,6,5},{6,6,6},{6,6,7},{6,6,8},{6,6,9},{6,7,0},{6,7,1},{6,7,2},{6,7,3},{6,7,4},
{6,7,5},{6,7,6},{6,7,7},{6,7,8},{6,7,9},{6,8,0},{6,8,1},{6,8,2},{6,8,3},{6,8,4},{6,8,5},{6,8,6},{6,8,7},{6,8,8},{6,8,9},
{6,9,0},{6,9,1},{6,9,2},{6,9,3},{6,9,4},{6,9,5},{6,9,6},{6,9,7},{6,9,8},{6,9,9},{7,0,0},{7,0,1},{7,0,2},{7,0,3},{7,0,4},
{7,0,5},{7,0,6},{7,0,7},{7,0,8},{7,0,9},{7,1,0},{7,1,1},{7,1,2},{7,1,3},{7,1,4},{7,1,5},{7,1,6},{7,1,7},{7,1,8},{7,1,9},
{7,2,0},{7,2,1},{7,2,2},{7,2,3},{7,2,4},{7,2,5},{7,2,6},{7,2,7},{7,2,8},{7,2,9},{7,3,0},{7,3,1},{7,3,2},{7,3,3},{7,3,4},
{7,3,5},{7,3,6},{7,3,7},{7,3,8},{7,3,9},{7,4,0},{7,4,1},{7,4,2},{7,4,3},{7,4,4},{7,4,5},{7,4,6},{7,4,7},{7,4,8},{7,4,9},
{7,5,0},{7,5,1},{7,5,2},{7,5,3},{7,5,4},{7,5,5},{7,5,6},{7,5,7},{7,5,8},{7,5,9},{7,6,0},{7,6,1},{7,6,2},{7,6,3},{7,6,4},
{7,6,5},{7,6,6},{7,6,7},{7,6,8},{7,6,9},{7,7,0},{7,7,1},{7,7,2},{7,7,3},{7,7,4},{7,7,5},{7,7,6},{7,7,7},{7,7,8},{7,7,9},
{7,8,0},{7,8,1},{7,8,2},{7,8,3},{7,8,4},{7,8,5},{7,8,6},{7,8,7},{7,8,8},{7,8,9},{7,9,0},{7,9,1},{7,9,2},{7,9,3},{7,9,4},
{7,9,5},{7,9,6},{7,9,7},{7,9,8},{7,9,9},{8,0,0},{8,0,1},{8,0,2},{8,0,3},{8,0,4},{8,0,5},{8,0,6},{8,0,7},{8,0,8},{8,0,9},
{8,1,0},{8,1,1},{8,1,2},{8,1,3},{8,1,4},{8,1,5},{8,1,6},{8,1,7},{8,1,8},{8,1,9},{8,2,0},{8,2,1},{8,2,2},{8,2,3},{8,2,4},
{8,2,5},{8,2,6},{8,2,7},{8,2,8},{8,2,9},{8,3,0},{8,3,1},{8,3,2},{8,3,3},{8,3,4},{8,3,5},{8,3,6},{8,3,7},{8,3,8},{8,3,9},
{8,4,0},{8,4,1},{8,4,2},{8,4,3},{8,4,4},{8,4,5},{8,4,6},{8,4,7},{8,4,8},{8,4,9},{8,5,0},{8,5,1},{8,5,2},{8,5,3},{8,5,4},
{8,5,5},{8,5,6},{8,5,7},{8,5,8},{8,5,9},{8,6,0},{8,6,1},{8,6,2},{8,6,3},{8,6,4},{8,6,5},{8,6,6},{8,6,7},{8,6,8},{8,6,9},
{8,7,0},{8,7,1},{8,7,2},{8,7,3},{8,7,4},{8,7,5},{8,7,6},{8,7,7},{8,7,8},{8,7,9},{8,8,0},{8,8,1},{8,8,2},{8,8,3},{8,8,4},
{8,8,5},{8,8,6},{8,8,7},{8,8,8},{8,8,9},{8,9,0},{8,9,1},{8,9,2},{8,9,3},{8,9,4},{8,9,5},{8,9,6},{8,9,7},{8,9,8},{8,9,9},
{9,0,0},{9,0,1},{9,0,2},{9,0,3},{9,0,4},{9,0,5},{9,0,6},{9,0,7},{9,0,8},{9,0,9},{9,1,0},{9,1,1},{9,1,2},{9,1,3},{9,1,4},
{9,1,5},{9,1,6},{9,1,7},{9,1,8},{9,1,9},{9,2,0},{9,2,1},{9,2,2},{9,2,3},{9,2,4},{9,2,5},{9,2,6},{9,2,7},{9,2,8},{9,2,9},
{9,3,0},{9,3,1},{9,3,2},{9,3,3},{9,3,4},{9,3,5},{9,3,6},{9,3,7},{9,3,8},{9,3,9},{9,4,0},{9,4,1},{9,4,2},{9,4,3},{9,4,4},
{9,4,5},{9,4,6},{9,4,7},{9,4,8},{9,4,9},{9,5,0},{9,5,1},{9,5,2},{9,5,3},{9,5,4},{9,5,5},{9,5,6},{9,5,7},{9,5,8},{9,5,9},
{9,6,0},{9,6,1},{9,6,2},{9,6,3},{9,6,4},{9,6,5},{9,6,6},{9,6,7},{9,6,8},{9,6,9},{9,7,0},{9,7,1},{9,7,2},{9,7,3},{9,7,4},
{9,7,5},{9,7,6},{9,7,7},{9,7,8},{9,7,9},{9,8,0},{9,8,1},{9,8,2},{9,8,3},{9,8,4},{9,8,5},{9,8,6},{9,8,7},{9,8,8},{9,8,9},
{9,9,0},{9,9,1},{9,9,2},{9,9,3},{9,9,4},{9,9,5},{9,9,6},{9,9,7},{9,9,8},{9,9,9}
};

/**
 * The differentDigits function calculates how many different digits build up the input value.
 *
 * @param  uint32 inputVal: the base number of different digit calculation
 * @return uint8: the number of different digits within inputVal
 */
uint8 differentDigits(uint32 inputVal)
{
    uint8 retVal = 0u;
    uint8 digits[10u] = { 0u };
    uint32 mod;

    /*
     * The number is divided by 1000 in every cycle.
     * Before the division, the remainder is calculated (0..999) because
     * the individual digits in range [0..999] can be acquired using the lookup table.
     *
     * 1 000 000 000 or bigger  - 4 partitions, 3 divide operations are required
     * 1 000 000 or bigger      - 3 partitions, 2 divide operations are required
     * 1 000 or bigger          - 2 partitions, 1 divide operation is required
     * 999 or smaller           - 1 partition, no division required
     */

    /* If the number is at least 1 000 000 000, then 3 more divide operations are required to iterate through the number */
    if (inputVal > 999999999u)
    {
        mod = inputVal % 1000u;
        ++digits[index_table[mod][0u]];
        ++digits[index_table[mod][1u]];
        ++digits[index_table[mod][2u]];
        inputVal /= 1000u;
    }
    
    /* If the number is at least 1 000 000, then 2 more divide operations are required to iterate through the number */
    if (inputVal > 999999u)
    {
        mod = inputVal % 1000u;
        ++digits[index_table[mod][0u]];
        ++digits[index_table[mod][1u]];
        ++digits[index_table[mod][2u]];
        inputVal /= 1000u;
    }
    
    /* If the number is at least 1 000, then 1 more divide operation is required at a minimum to iterate through the number */
    if (inputVal > 999u)
    {
        mod = inputVal % 1000u;
        ++digits[index_table[mod][0u]];
        ++digits[index_table[mod][1u]];
        ++digits[index_table[mod][2u]];
        inputVal /= 1000u;
    }

    /*
     * If the number is smaller than 1 000, then no more divide operation is required as the remaining digits can be acquired
     * using the lookup table.
     */
    if (inputVal > 99u)
    {
        /* All digits are relevant */
        ++digits[index_table[inputVal][0u]];
        ++digits[index_table[inputVal][1u]];
        ++digits[index_table[inputVal][2u]];
    }
    else if (inputVal > 9u)
    {
        /* Only the last 2 digits are relevant */
        ++digits[index_table[inputVal][1u]];
        ++digits[index_table[inputVal][2u]];
    }
    else
    {
        /* Only the last digit is relevant */
        ++digits[index_table[inputVal][2u]];
    }

    /* Count the different digits */
    if (0u != digits[0]) { ++retVal; }
    if (0u != digits[1]) { ++retVal; }
    if (0u != digits[2]) { ++retVal; }
    if (0u != digits[3]) { ++retVal; }
    if (0u != digits[4]) { ++retVal; }
    if (0u != digits[5]) { ++retVal; }
    if (0u != digits[6]) { ++retVal; }
    if (0u != digits[7]) { ++retVal; }
    if (0u != digits[8]) { ++retVal; }
    if (0u != digits[9]) { ++retVal; }

    /* 
     * The copy-pasted if branches could be replaced by a for/while loop,
     * it would have no impact on x64-based computers,
     * but it makes a noticeable difference on microcontroller-based embedded systems.
     */

    return retVal;
}
